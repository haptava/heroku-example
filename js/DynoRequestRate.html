<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Dyno Request Rate</title>

  <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js'></script>
  <script type='text/javascript' src='http://code.highcharts.com/highcharts.js'></script>
  <script type='text/javascript'>

    var src = 'https://api.haptava.io/public/versly/queries/72e17e5f-58ed-4a41-a29d-3dcd52aa00c5';
    var chart;

    function requestData() {
      $.ajax({
        url: src,
        success: function (json) {

          if (chart.series.length != json.length) {
            location.reload();
          }
          else {
            for (i = 0; i < chart.series.length; i++) {
              chart.series[i].setData(json[i].data);
            }
          }

          // call it again after a pause
          setTimeout(requestData, 3000);
        },
        cache: false
      });
    }

    $(document).ready(function () {
      var options = {
        chart: {
          type: 'bar',
          renderTo: 'container',
          events: {
            load: requestData
          }
        },
        title: {
          text: ''
        },
        subtitle: {
          text: ''
        },
        xAxis: {
          min: 0,
          crosshair: true,
          title: {
            text: ''
          },
          categories: []
        },
        yAxis: {
          min: 0,
          title: {
            text: ''
          }
        },
        tooltip: {
          headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
          pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
          '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
          footerFormat: '</table>',
          shared: true,
          useHTML: true
        },
        series: [{
          name: '',
          data: []
        }]
      };

      $.getJSON(src,
          function (json) {
            options.title.text = json[0].chart_title;
            options.subtitle.text = json[0].chart_subtitle;
            options.xAxis.title.text = json[0].xAxis_title;
            options.yAxis.title.text = json[0].yAxis_title;
            options.xAxis.categories = json[0].categories;
            options.series = json;
            chart = new Highcharts.Chart(options);
          });
    });
  </script>

</head>
<body>

<div id="container" style="min-width: 400px; height: 800px; margin: 0 auto"></div>

</body>
</html>